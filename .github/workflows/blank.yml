name: ğŸš€ Auto Cool Level Generator

on:
  schedule:
    - cron: '*/15 * * * *' # Setiap 15 menit sekali
  workflow_dispatch:

jobs:
  generate-level:
    name: ğŸŒŸ Generate Cool Level
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout Code
        uses: actions/checkout@v4

      - name: âœ¨â­ï¸ğŸ§¡ Epic Level Unlocked Banner
        run: |
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘"
          echo "â•‘   ğŸ‰â­ï¸ğŸ§¡ ï¼¬ï¼¥ï¼¶ï¼¥ï¼¬   ï¼µï¼®ï¼¬ï¼¯ï¼£ï¼«ï¼¥ï¼¤ ! ğŸ§¡â­ï¸ğŸ‰"
          echo "â•‘      âœ¦âœ¦âœ¦  THE GATE TO GLORY OPENS  âœ¦âœ¦âœ¦"
          echo "â•‘"
          echo "â•‘   ğŸš€ğŸ”¥ğŸ’ ï¼®ï¼¥ï¼·   ï¼£ï¼¯ï¼¯ï¼¬   ï¼¬ï¼¥ï¼¶ï¼¥ï¼¬ ğŸ’ğŸ”¥ğŸš€"
          echo "â•‘      âœ¦âœ¦âœ¦  UNLEASH YOUR NEXT POWER!  âœ¦âœ¦âœ¦"
          echo "â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""

      - name: ğŸ“ Generate Next Cool Level (no ASCII)
        shell: bash
        run: |
          set -e

          cool_names=(
            "Vortex" "Nebula" "Phoenix" "Falcon" "Titan" "Shadow" "Blaze" "Nova" "Specter" "Stellar"
            "Inferno" "Cosmos" "Zephyr" "Obsidian" "Glacier" "Thunder" "Matrix" "Aurora" "Samurai" "Ninja"
            "Ronin" "Valkyrie" "Oracle" "Sonic" "Ranger" "Drift" "Mirage" "Cipher" "Echo" "Titanium"
            "Genesis" "Saber" "Onyx" "Blizzard" "Venom" "Storm" "Astro" "Galaxy" "Eclipse" "Magma"
            "Turbo" "Rogue" "Elemental" "Surge" "Radiant" "Zenith" "Prime" "Sentinel" "Golem" "Mystic"
          )

          mkdir -p levels

          last_name=""
          if ls levels/level-*-*.txt 1> /dev/null 2>&1; then
            last_file=$(ls levels/level-*-*.txt | sort | tail -n 1)
            last_name=$(basename "$last_file" | sed -E 's/level-[0-9]{8}-[0-9]{4}-(.*)\.txt/\1/')
          fi

          idx=0
          if [ -n "$last_name" ]; then
            for i in "${!cool_names[@]}"; do
              if [[ "${cool_names[$i]}" == "$last_name" ]]; then
                idx=$(( (i + 1) % ${#cool_names[@]} ))
                break
              fi
            done
          fi

          next_name="${cool_names[$idx]}"
          file_name="levels/level-$(date +%Y%m%d-%H%M)-${next_name}.txt"

          {
            echo "# ğŸŒŒ Level: $next_name"
            echo "# Generated at: $(date -u)"
            echo "# Dijalankan oleh: zayydenzi@gmail.com"
          } > "$file_name"

          echo "LEVEL_NAME=$next_name" >> $GITHUB_ENV
          echo "Created $file_name"

      - name: â° Generate Formatted Time
        run: |
          echo "FORMATTED_TIME=$(TZ='Asia/Jakarta' date '+%d-%m-%Y %H:%M:%S WIB')" >> $GITHUB_ENV

      - name: ğŸ”¢ Generate Notification Counter
        id: notif-counter
        run: |
          count=$(ls levels/level-*-*.txt 2>/dev/null | wc -l)
          echo "NOTIF_COUNTER=$count" >> $GITHUB_ENV

      - name: ğŸ”” Kirim Notifikasi ke Telegram
        uses: appleboy/telegram-action@v0.1.0
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            <b>â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</b>
            <b>ğŸ‰â­ï¸ğŸ§¡ LEVEL UNLOCKED! ğŸ§¡â­ï¸ğŸ‰</b>
            <b>âœ¦âœ¦âœ¦ THE GATE TO GLORY OPENS âœ¦âœ¦âœ¦</b>
            <b>ğŸš€ğŸ”¥ğŸ’ NEW COOL LEVEL ğŸ’ğŸ”¥ğŸš€</b>
            <b>âœ¦âœ¦âœ¦ UNLEASH YOUR NEXT POWER! âœ¦âœ¦âœ¦</b>
            <b>â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</b>

            ğŸ® <b>Level Baru:</b> <i>${{ env.LEVEL_NAME }}</i>
            ğŸ—‚ï¸ <b>Repo:</b> <code>${{ github.repository }}</code>
            ğŸ•’ <b>Waktu:</b> <code>${{ env.FORMATTED_TIME }}</code>
            ğŸ”¢ <b>Notifikasi ke:</b> <b>${{ env.NOTIF_COUNTER }}</b>
            ğŸ‘¤ <b>Dibuat oleh:</b> <i>zayydenzi@gmail.com</i>
            <b>ğŸ’¯ Script 100% Created By : Abie Haryatmo</b>
            <b>#NextLevel</b>
            <b><span style="font-family: 'Arial Black', Arial, Impact, sans-serif; font-size: 15px; color: #1f8ceb;">First, solve the problem. Then, write the code.</span></b>
          format: html

      - name: ğŸ¤– Configure Git
        run: |
          git config user.name "zayydenzi"
          git config user.email "zayydenzi@gmail.com"

      - name: ğŸš© Commit & Push Changes
        run: |
          git add levels/
          git commit -m "âœ¨ Add Level: ${{ env.LEVEL_NAME }} (by zayydenzi@gmail.com)" || echo "Nothing to commit"
          git push
